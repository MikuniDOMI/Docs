# 函数列表

:::danger

本库大部分方法都为异步，且需要管理员权限运行

:::

## 目录

- [核心类](#核心类)
  - [BedrockCore](#bedrockcore)
- [配置选项](#配置选项)
  - [CoreOptions](#coreoptions)
- [回调与状态](#回调与状态)
  - [InstallCallback](#installcallback)
  - [InstallStates](#installstates)
- [数据模型](#数据模型)
  - [VersionInformation](#versioninformation)
  - [VersionDetils](#versiondetils)
  - [GameBackGroundEditer](#gamebackgroundediter)
- [工具类](#工具类)
  - [FrameworkComplete.CompleteVC](#frameworkcompletecompletevc)
  - [ManifestEditor.EditManifest](#manifesteditoreditmanifest)
  - [Native 注册与安装](#native-注册与安装)
- [下载器](#下载器)
  - [ImprovedFlexibleMultiThreadDownloader](#improvedflexiblemultithreaddownloader)
---

## 核心类

### `BedrockCore`

位于命名空间：`BedrockLauncher.Core`

#### `Init()`
初始化核心模块。

> **说明**：必须在调用其他功能前调用此方法。

```csharp
public static void Init()
```

---

#### `OpenWindowsDevelopment()`
开启 Windows 开发者模式。

> **注意**：需要管理员权限。

```csharp
public static void OpenWindowsDevelopment()
```

---

#### `GetWindowsDevelopmentState()`
获取当前 Windows 开发者模式状态。

> **返回值**：
> - `true`：已开启
> - `false`：未开启

```csharp
public static bool GetWindowsDevelopmentState()
```

---

#### `InstallVersion(VersionInformation, string, string, InstallCallback, GameBackGroundEditer)`
安装 Minecraft 指定版本。

```csharp
public static void InstallVersion(
    VersionInformation information,
    string install_dir,
    string callback,
    InstallCallback callback,
    GameBackGroundEditer gameBackGround = null
)
```

| 参数 | 类型 | 说明 |
|------|------|------|
| `information` | `VersionInformation` | 版本信息对象 |
| `install_dir` | `string` | 安装目录（绝对路径） |
| `callback` | `InstallCallback` | 安装过程回调 |
| `gameBackGround` | `GameBackGroundEditer` | （可选）游戏启动背景修改设置 |

> **提示**：若不清楚 `gameBackGround` 的作用，请保持为 `null`。

---

#### `ChangeVersion(string, InstallCallback)`
切换当前运行的游戏版本。

```csharp
public static bool ChangeVersion(string versionPath, InstallCallback callback)
```

| 参数 | 类型 | 说明 |
|------|------|------|
| `versionPath` | `string` | 游戏本体文件夹路径（绝对路径），需包含 `AppxManifest.xml` |
| `callback` | `InstallCallback` | 回调对象，用于接收进度 |

> **注意**：调用 `LaunchGame` 前应先调用此方法指定版本。

---

#### `LaunchGame(VersionType)`
启动游戏。

```csharp
public static bool LaunchGame(VersionType versionType)
```

| 参数 | 类型 | 说明 |
|------|------|------|
| `versionType` | `VersionType` | 要启动的版本类型 |

> **前提**：如需切换版本，请先调用 `ChangeVersion`。

---

#### `StopGame()`
关闭正在运行的游戏。

```csharp
public static bool StopGame()
```

> **返回值**：是否成功关闭。

---

#### `RemoveGame(VersionType)`
删除指定版本的游戏。

```csharp
public static Task<bool> RemoveGame(VersionType versionType)
```

| 参数 | 类型 | 说明 |
|------|------|------|
| `versionType` | `VersionType` | 要删除的版本类型 |

> **警告**：此操作不可逆，请确认后再执行。

---

## 配置选项

### `CoreOptions`

位于命名空间：`BedrockLauncher.Core.CoreOption`

| 属性 | 类型 | 说明 |
|------|------|------|
| `autoOpenWindowsDevelopment` | `bool` | 是否自动开启 Windows 开发者模式 |
| `localDir` | `string` | 安装目录（绝对路径） |
| `autoCompleteVC` | `bool` | 是否自动补全 VC/UWP 运行库 |

---

## 回调与状态

### `InstallCallback`

用于监听安装过程中的进度与结果。

| 属性 | 类型 | 说明 |
|------|------|------|
| `CancellationToken` | `CancellationToken` | 取消操作的 Token |
| `downloadProgress` | `IProgress<DownloadProgress>` | 下载进度回调 |
| `registerProcess_percent` | `Action<float>` | 部署注册进度（0~100） |
| `result_callback` | `Action<bool, string>` | 安装结果回调（成功/失败 + 消息） |
| `install_states` | `Action<InstallStates>` | 安装状态变更通知 |

---

### `InstallStates`

表示安装过程中的状态枚举。

| 值 | 说明 |
|-----|------|
| `Downloading` | 正在下载 |
| `Extracting` | 正在解压 |
| `Registering` | 正在注册应用 |
| `Completed` | 安装完成 |
| `Failed` | 安装失败 |
| `Canceled` | 用户取消 |

---

## 数据模型

### `VersionInformation`

描述一个 Minecraft 版本的基本信息。

| 属性 | 类型 | 说明 |
|------|------|------|
| `Type` | `string` | 版本类型（如正式版、测试版） |
| `ID` | `string` | 版本唯一标识 |
| `Date` | `DateTime` | 发布日期 |
| `Variations` | `List<VersionDetils>` | 不同架构的版本变体列表 |

---

### `VersionDetils`

描述某一特定架构下的版本详情。

| 属性 | 类型 | 说明 |
|------|------|------|
| `Arch` | `string` | 架构（如 x86, x64, ARM64） |
| `ArchivalStatus` | `string` | 发布状态（如 Active, Deprecated） |
| `OSbuild` | `int` | 所需最低 Windows 构建号 |
| `UpdateIds` | `List<string>` | 关联的 Update ID 列表 |
| `MD5` | `string` | 文件的 MD5 校验值 |

---

### `GameBackGroundEditer`

用于修改游戏启动画面背景。

| 字段 | 类型 | 说明 |
|------|------|------|
| `file` | `string` | 背景图片文件的相对路径 |
| `color` | `string` | 背景颜色（Hex 16进制，如 `#FF0000`） |
| `isOpen` | `bool` | 是否启用自定义背景功能 |

> **警告**：修改此设置可能影响启动稳定性。

---

## 工具类

### `FrameworkComplete.CompleteVC`

自动补全 VC++ 和 UWP 运行库依赖。

```csharp
public static async Task CompleteVC()
```

> **异常**：若安装失败会抛出 `System.Exception`。
> **行为**：如果所需运行库已存在，则跳过安装。

---

### `ManifestEditor.EditManifest`

修改 `AppxManifest.xml` 并添加自定义能力文件（CustomCapability.SCCD）。

```csharp
public static bool EditManifest(string manifestPath, GameBackGroundEditer backgroundEditor)
```

| 参数 | 类型 | 说明 |
|------|------|------|
| `manifestPath` | `string` | `AppxManifest.xml` 文件路径 |
| `backgroundEditor` | `GameBackGroundEditer` | 背景编辑配置 |

> **返回值**：
> - `true`：修改成功
> - `false`：失败（如文件不存在或权限不足）

---

### Native 注册与安装

位于命名空间：`BedrockLauncher.Core.Native`

#### `RegisterAppxAsync`

异步注册 AppX 包（主程序包）。

```csharp
public static void RegisterAppxAsync(
    string appxXmlpath,
    Action<IAsyncOperationWithProgress<DeploymentResult, DeploymentProgress>, DeploymentProgress> ProgressCallAction,
    Action<IAsyncOperationWithProgress<DeploymentResult, DeploymentProgress>, AsyncStatus> completeAction
)
```

| 参数 | 说明 |
|------|------|
| `appxXmlpath` | `AppxManifest.xml` 所在路径 |
| `ProgressCallAction` | 进度回调 |
| `completeAction` | 完成回调（成功/失败/取消） |

> **提示**：建议使用 `TaskCompletionSource` 包装以支持 `await`。

---

#### `addAppxAsync`

异步添加框架类 AppX 包（如运行库）。

```csharp
public static void addAppxAsync(
    string appxPath,
    Action<IAsyncOperationWithProgress<DeploymentResult, DeploymentProgress>, DeploymentProgress> ProgressCallAction,
    Action<IAsyncOperationWithProgress<DeploymentResult, DeploymentProgress>, AsyncStatus> completeAction
)
```

| 参数 | 说明 |
|------|------|
| `appxPath` | `.appx` 或 `.msix` 文件路径 |
| `ProgressCallAction` | 部署进度回调 |
| `completeAction` | 完成状态回调 |

---

## 下载器

### `ImprovedFlexibleMultiThreadDownloader`

高性能多线程下载器，支持断点续传（若服务器支持）。

#### 构造函数

```csharp
public ImprovedFlexibleMultiThreadDownloader(int maxConcurrency, int bufferSize, int defaultTimeoutSeconds = 100)
```

| 参数 | 说明 |
|------|------|
| `maxConcurrency` | 最大并发线程数（推荐 4~8） |
| `bufferSize` | 每次读写缓冲区大小（字节） |
| `defaultTimeoutSeconds` | 单个请求超时时间（秒，默认 100） |

---

#### `DownloadAsync`

执行异步下载任务。

```csharp
public async Task<bool> DownloadAsync(
    string url,
    string filePath,
    IProgress<DownloadProgress> progress = null,
    CancellationToken cancellationToken = default
)
```

| 参数 | 类型 | 说明 |
|------|------|------|
| `url` | `string` | 下载文件的 URL |
| `filePath` | `string` | 本地保存路径 |
| `progress` | `IProgress<DownloadProgress>` | 下载进度回调 |
| `cancellationToken` | `CancellationToken` | 支持取消下载 |

> **返回值**：
> - `true`：下载成功
> - `false`：失败（网络错误、取消、校验失败等）

---

#### `DownloadProgress`

提供下载进度信息。

| 属性 | 类型 | 说明 |
|------|------|------|
| `TotalBytes` | `long` | 总大小（未知时为 -1） |
| `DownloadedBytes` | `long` | 已下载字节数 |
| `ProgressPercentage` | `int` | 进度百分比（0~100，未知时为 -1） |

---

## 使用示例

### 安装最新版本

```csharp
var versionInfo = new VersionInformation {
    ID = "1.20.10",
    Type = "Release",
    Variations = new List<VersionDetils> {
        new VersionDetils {
            Arch = "x64",
            OSbuild = 19041,
            UpdateIds = new List<string> { "Microsoft.MinecraftUWP_8wekyb3d8bbwe" },
            MD5 = "a1b2c3..."
        }
    }
};

var callback = new InstallCallback {
    downloadProgress = new Progress<DownloadProgress>(progress => {
        Console.WriteLine($"下载: {progress.ProgressPercentage}%");
    }),
    registerProcess_percent = percent => {
        Console.WriteLine($"部署: {percent}%");
    },
    result_callback = (success, msg) => {
        Console.WriteLine(success ? "安装成功" : $"失败: {msg}");
    },
    install_states = state => {
        Console.WriteLine($"状态: {state}");
    }
};

await BedrockCore.InstallVersion(versionInfo, @"C:\MC\Versions\1.20.10", callback);
```

---

## 注意事项

- 所有涉及 UWP 安装的操作均需 **管理员权限**。
- 修改 `AppxManifest.xml` 可能导致签名失效，需重新注册。
- `GameBackGroundEditer` 功能实验性较强，建议谨慎使用。
- 推荐在调用 `Init()` 后检查 `CoreOptions` 设置。

---

## 版本兼容性

- 支持 Windows 10 / 11（Build 19041 及以上）
- .NET 5 或 .NET Framework 4.8+
- 需启用开发者模式（或自动开启）

---

> 📄 文档版本：1.0  
> © 2025 BedrockLauncher Team. 保留所有权利。

--- 

你可以将此 `.md` 文件放入项目的 `docs/` 目录中，配合 GitHub Pages 或 DocFx 使用，生成美观的在线文档。需要我帮你生成 HTML 或添加导航结构吗？